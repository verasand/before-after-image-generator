<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Before & After Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom File Input Styling */
        input[type="file"]::file-selector-button {
            margin-right: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            border: 0;
            font-size: 0.875rem;
            font-weight: 600;
            background-color: #e0f2fe; 
            color: #0c4a6e;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        input[type="file"]::file-selector-button:hover {
            background-color: #bae6fd;
        }

        /* SLIDER STYLES */
        .slider-container {
            position: relative;
            overflow: hidden;
            user-select: none;
            cursor: ew-resize;
            width: 100%;
            /* Eliminamos height fija - será dinámica */
        }
        
        .slider-image {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Cambiado de cover a contain */
            object-position: center;
            pointer-events: none;
            display: block;
        }

        .slider-overlay {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 50%;
            overflow: hidden;
            border-right: 3px solid white;
            box-shadow: 5px 0 15px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .slider-overlay img {
            max-width: none;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .slider-handle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20;
            pointer-events: none;
        }

        /* Labels inside slider */
        .slider-label {
            position: absolute;
            top: 1rem;
            padding: 0.25rem 0.75rem;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-weight: bold;
            pointer-events: none;
            z-index: 30;
        }
        .label-before { left: 1rem; }
        .label-after { right: 1rem; }

        /* Drag & Drop */
        .drop-zone {
            border: 2px dashed #cbd5f5;
            transition: border-color 0.15s ease, background-color 0.15s ease;
        }

        .drop-zone.is-dragover {
            border-color: #2563eb;
            background-color: #eff6ff;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen flex items-center justify-center p-4">

    <main class="bg-white shadow-2xl rounded-2xl p-6 sm:p-10 max-w-5xl w-full">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-8">
            Before & After Tool
        </h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8 mb-8">
            <div class="flex flex-col">
                <h2 class="text-lg font-semibold text-blue-600 mb-2 text-center">1. Upload Before</h2>
                <div id="before-drop" class="drop-zone bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <input type="file" id="before-upload" accept="image/*" class="block w-full text-sm text-gray-600">
                    <div class="mt-4 w-full h-48 bg-gray-200 rounded-lg flex items-center justify-center overflow-hidden">
                        <img id="before-preview" src="" class="hidden w-full h-full object-cover">
                        <span id="before-placeholder" class="text-gray-500 text-sm">Preview</span>
                    </div>
                    <p class="mt-3 text-xs text-gray-500 text-center">Drop image here or click to browse</p>
                </div>
            </div>

            <div class="flex flex-col">
                <h2 class="text-lg font-semibold text-purple-600 mb-2 text-center">2. Upload After</h2>
                <div id="after-drop" class="drop-zone bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <input type="file" id="after-upload" accept="image/*" class="block w-full text-sm text-gray-600">
                    <div class="mt-4 w-full h-48 bg-gray-200 rounded-lg flex items-center justify-center overflow-hidden">
                        <img id="after-preview" src="" class="hidden w-full h-full object-cover">
                        <span id="after-placeholder" class="text-gray-500 text-sm">Preview</span>
                    </div>
                    <p class="mt-3 text-xs text-gray-500 text-center">Drop image here or click to browse</p>
                </div>
            </div>
        </div>

        <div class="text-center flex flex-col sm:flex-row justify-center gap-4 border-b border-gray-200 pb-8 mb-8">
            <button id="generate-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all" disabled>
                Generate Comparison
            </button>
            <button id="clear-btn" class="bg-gray-500 text-white font-medium py-3 px-8 rounded-lg shadow hover:bg-gray-600 transition-all">
                Clear All
            </button>
        </div>

        <div id="result-section" class="hidden space-y-12">
            
            <div class="flex flex-col items-center">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                    Interactive Preview
                </h2>
                <p class="text-gray-500 mb-4 text-sm">Drag or hover to compare</p>
                
                <div id="slider-container" class="slider-container max-w-4xl rounded-xl shadow-xl bg-gray-200">
                    
                    <span class="slider-label label-after">AFTER</span>
                    <span class="slider-label label-before">BEFORE</span>

                    <img id="slider-img-after" src="" alt="After" class="slider-image">
                    
                    <div id="slider-overlay" class="slider-overlay">
                        <img id="slider-img-before" src="" alt="Before" class="slider-image">
                    </div>

                    <div id="slider-handle" class="slider-handle">
                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path></svg>
                    </div>
                </div>
            </div>

            <div class="flex flex-col items-center pt-8 border-t border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    Download Static Image
                </h2>
                <div class="max-w-2xl w-full bg-gray-100 p-2 rounded-lg mb-4">
                    <img id="static-result-image" src="" class="w-full h-auto rounded border border-gray-300">
                </div>
                <a id="download-link" href="#" download="comparison.png" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg shadow hover:bg-green-700 transition-all transform hover:scale-105">
                    Download Side-by-Side
                </a>
            </div>
        </div>

    </main>

    <script>
        // --- VARIABLES ---
        const beforeUpload = document.getElementById('before-upload');
        const afterUpload = document.getElementById('after-upload');
        const beforePreview = document.getElementById('before-preview');
        const afterPreview = document.getElementById('after-preview');
        const generateBtn = document.getElementById('generate-btn');
        const clearBtn = document.getElementById('clear-btn');
        const resultSection = document.getElementById('result-section');
        const beforeDrop = document.getElementById('before-drop');
        const afterDrop = document.getElementById('after-drop');
        
        // Static Image Elements
        const staticResultImage = document.getElementById('static-result-image');
        const downloadLink = document.getElementById('download-link');

        // Slider Elements
        const sliderContainer = document.getElementById('slider-container');
        const sliderOverlay = document.getElementById('slider-overlay');
        const sliderHandle = document.getElementById('slider-handle');
        const sliderImgBefore = document.getElementById('slider-img-before');
        const sliderImgAfter = document.getElementById('slider-img-after');

        let beforeSrc = null;
        let afterSrc = null;

        // --- UPLOAD HANDLERS ---
        function handleFile(file, type) {
            if (!file) return;
            if (!file.type || !file.type.startsWith('image/')) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                const src = event.target.result;
                if (type === 'before') {
                    beforeSrc = src;
                    beforePreview.src = src;
                    beforePreview.classList.remove('hidden');
                    document.getElementById('before-placeholder').classList.add('hidden');
                } else {
                    afterSrc = src;
                    afterPreview.src = src;
                    afterPreview.classList.remove('hidden');
                    document.getElementById('after-placeholder').classList.add('hidden');
                }
                
                if (beforeSrc && afterSrc) generateBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        function handleUpload(e, type) {
            handleFile(e.target.files[0], type);
        }

        beforeUpload.addEventListener('change', (e) => handleUpload(e, 'before'));
        afterUpload.addEventListener('change', (e) => handleUpload(e, 'after'));

        // --- DRAG & DROP ---
        function setupDropZone(dropEl, inputEl, type) {
            const preventDefaults = (e) => {
                e.preventDefault();
                e.stopPropagation();
            };

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach((eventName) => {
                dropEl.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach((eventName) => {
                dropEl.addEventListener(eventName, () => dropEl.classList.add('is-dragover'));
            });

            ['dragleave', 'drop'].forEach((eventName) => {
                dropEl.addEventListener(eventName, () => dropEl.classList.remove('is-dragover'));
            });

            dropEl.addEventListener('drop', (e) => {
                const file = e.dataTransfer.files && e.dataTransfer.files[0];
                handleFile(file, type);
            });

            dropEl.addEventListener('click', () => inputEl.click());
        }

        setupDropZone(beforeDrop, beforeUpload, 'before');
        setupDropZone(afterDrop, afterUpload, 'after');

        // --- FUNCIÓN PARA CALCULAR Y ESTABLECER ALTURA DINÁMICA ---
        function setDynamicHeight() {
            const img1 = new Image();
            const img2 = new Image();
            img1.src = beforeSrc;
            img2.src = afterSrc;

            let loadedCount = 0;
            const onLoad = () => {
                loadedCount++;
                if (loadedCount < 2) return;

                // Obtener el ancho actual del contenedor
                const containerWidth = sliderContainer.offsetWidth;
                
                // Calcular aspect ratios
                const ratio1 = img1.naturalHeight / img1.naturalWidth;
                const ratio2 = img2.naturalHeight / img2.naturalWidth;
                
                // Usar el aspect ratio más alto para que ambas imágenes se vean completas
                const maxRatio = Math.max(ratio1, ratio2);
                
                // Calcular la altura basada en el ancho del contenedor
                const calculatedHeight = containerWidth * maxRatio;
                
                // Establecer altura del contenedor
                sliderContainer.style.height = calculatedHeight + 'px';
                
                // Asegurar que la imagen del overlay tenga el ancho correcto
                sliderImgBefore.style.width = containerWidth + 'px';
            };

            img1.onload = onLoad;
            img2.onload = onLoad;
        }

        // --- GENERATE FUNCTION ---
        generateBtn.addEventListener('click', () => {
            if (!beforeSrc || !afterSrc) return;

            // 1. Setup Slider
            sliderImgBefore.src = beforeSrc;
            sliderImgAfter.src = afterSrc;
            
            // 2. Show Results
            resultSection.classList.remove('hidden');

            // 3. Calcular y establecer altura dinámica
            setTimeout(() => {
                setDynamicHeight();
                // Reset slider position to center después de calcular altura
                updateSliderPosition(sliderContainer.offsetWidth / 2);
            }, 50);

            // 4. Generate Static Side-by-Side Image (Canvas)
            generateStaticImage();
            
            resultSection.scrollIntoView({ behavior: 'smooth' });
        });

        // --- SLIDER LOGIC ---
        let isDragging = false;

        function updateSliderPosition(x) {
            const containerRect = sliderContainer.getBoundingClientRect();
            const width = containerRect.width;
            
            // Ensure x is within bounds
            if (x < 0) x = 0;
            if (x > width) x = width;

            const percentage = (x / width) * 100;

            // Update DOM
            sliderOverlay.style.width = `${percentage}%`;
            sliderHandle.style.left = `${percentage}%`;
        }

        function handleMove(clientX) {
            const containerRect = sliderContainer.getBoundingClientRect();
            const x = clientX - containerRect.left;
            updateSliderPosition(x);
        }

        // Mouse Events
        sliderContainer.addEventListener('mousedown', () => isDragging = true);
        window.addEventListener('mouseup', () => isDragging = false);
        sliderContainer.addEventListener('mousemove', (e) => {
            handleMove(e.clientX);
        });

        // Touch Events (Mobile)
        sliderContainer.addEventListener('touchstart', (e) => {
            isDragging = true;
            handleMove(e.touches[0].clientX);
        }, {passive: true});
        
        sliderContainer.addEventListener('touchmove', (e) => {
            if (isDragging) handleMove(e.touches[0].clientX);
        }, {passive: true});

        sliderContainer.addEventListener('touchend', () => isDragging = false);

        // Window Resize: Recalcular altura y mantener proporción
        window.addEventListener('resize', () => {
            if (!resultSection.classList.contains('hidden') && beforeSrc && afterSrc) {
                setDynamicHeight();
            }
        });

        // --- STATIC IMAGE GENERATION (Canvas) ---
        function generateStaticImage() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img1 = new Image();
            const img2 = new Image();

            img1.src = beforeSrc;
            img2.src = afterSrc;

            let loadedCount = 0;
            const onImageLoad = () => {
                loadedCount++;
                if (loadedCount < 2) return;

                // Sizing Logic: Match heights
                const h = Math.max(img1.naturalHeight, img2.naturalHeight);
                const w1 = (img1.naturalWidth * h) / img1.naturalHeight;
                const w2 = (img2.naturalWidth * h) / img2.naturalHeight;

                canvas.width = w1 + w2;
                canvas.height = h + 80;

                // Background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw Images
                ctx.drawImage(img1, 0, 80, w1, h);
                ctx.drawImage(img2, w1, 80, w2, h);

                // Draw Labels
                ctx.font = 'bold 50px sans-serif';
                ctx.fillStyle = '#333';
                ctx.textAlign = 'center';
                ctx.fillText('BEFORE', w1 / 2, 55);
                ctx.fillText('AFTER', w1 + (w2 / 2), 55);

                // Output
                const dataURL = canvas.toDataURL('image/png');
                staticResultImage.src = dataURL;
                downloadLink.href = dataURL;
            };

            img1.onload = onImageLoad;
            img2.onload = onImageLoad;
        }

        // --- CLEAR ALL ---
        clearBtn.addEventListener('click', () => {
            beforeSrc = null;
            afterSrc = null;
            beforeUpload.value = '';
            afterUpload.value = '';
            beforePreview.classList.add('hidden');
            afterPreview.classList.add('hidden');
            document.getElementById('before-placeholder').classList.remove('hidden');
            document.getElementById('after-placeholder').classList.remove('hidden');
            resultSection.classList.add('hidden');
            generateBtn.disabled = true;
            // Reset altura del contenedor
            sliderContainer.style.height = '';
        });

    </script>
</body>
</html>
